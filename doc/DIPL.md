
### 2.4.2
笛卡儿积 A= {a,b} B = {0,1,2} AxB = {(a,0), (a,1), (a,2), (b,0), (b,1), (b,2)}

令Z和R分别表示整数集和实数集。取样处理可以看成吧xy平面分成一个网格的过程，网格中每个单元的中心坐标是笛卡儿积ZxZ中的一堆元素，ZxZ是所有有序元素对(zi,zj)的集合，zi，zj是Z中的整数

因此如果（x,y）是ZXZ种的整数，且f是把灰度值赋给每个特定坐标对(x,y)的一个函数，则f(x,y)就是一幅数字图像。

显然这种赋值过程就是一个量化处理的过程。灰度值是整数，则用Z代替R，然后数字图像变成一个二维函数，且他的坐标和幅值都是整数。

假设离散灰度级数L = 2^k 是等间隔的，且他们是区间[0,L-1] 内的整数。有时，由灰度跨越的值域称为 动态范围。我们将图像系统的动态范围定义为系统中最大可度量灰度与最小可检测灰度之比。

动态范围上限取决于饱和度，下线取决于噪声。定义一幅图像最高和最低灰度差为对比度。饱和度是值超过这个值的灰度级将被剪掉这样的一个最高值。

### 2.4.3
空间分辨率 是图像中可辨别最小细节的度量 有多种方法说明        没毫米线数对

    每单位距离先 对数 和每单位距离 点数（像素数）    
    每英寸点数：dpi （一般用N表示）

尺寸本身只是在图像容量间作比较才有帮助。？

如果没有规定图像包含的空间维数，那么我们说一幅图像的分辨率为1024x1024像素是没有意义的。

灰度分辨率  是指在灰度级中可分辨的最小变化。

通常说一幅背量化为256级的图像有 8比特（一般用k表示） 的回复分辨率

注：k值的减小带来对比度的增加，可能在人的主观印象上对图片的感觉越好

### 2.4.4   图像内插

内插是在诸如放大，收缩，旋转和几何校正等任务中广泛应用的工具。
近临内插法，把原图像中近邻的灰度，赋值给了每个新位置。  --边缘失真

750x750网格大小收缩到500x500图像一样大，然后网格中的数据取图像中最接近的像素

双线性内插：v(x,y) = ax + by + cxy + d

三次内插 v(x,y) = ∑i1~3 ∑j1~3 (aij * x^i * y^j)

## 2.5 像素间的基本关系
### 2.5.1相邻性
    p(x, y)的四领域 N4(p) 八领域N8(p)

### 2.5.2邻接性，连通性，区域和边界
令v是用于定义邻接性的灰度值合集。则V可能是灰度值（0~255）集合的任何一个子集

     a)4邻接。如果q在集合N4(p)中，则具有V中数值的两个像素p和q是4邻接的。

     b)8邻接。如果q在集合N8(p)中，则具有V中数值的两个像素p和q是8邻接的。

     c)m邻接。如果i)q在N4(p)中，或ii)q在Nd(p)中，且集合N4(p)且N4(q)为空，则具有V中数值的两个像素p和q是m邻接的。
---
### 2.5.3 距离度量
欧几里得 欧式 距离 即直线距离De(p,q)

距离D4(城市街区距离) D4(p,q) = |x-s| + |y-t|    //D4 = 1的像素是（x,y）的四领域

距离D8（棋盘距离） D8 = max(|x-s| ， |y-t|)  D8 = 1的像素是（x,y）的9领域

## 2.6 数字图像处理中用到的数学工具
### 2.6.1阵列/矩阵

阵列相乘 对应位置相乘

矩阵相乘 。。。
### 2.6.2线性操作和 非线性操作
图像处理方法最重要的分类之一是它是线性还是非线性的。

算子定义：对于给定的输入图像 H[f(x,y)] = g(x,y)

 如果H[aifi(x,y) + ajfj(x,y)] = aiH[fi(x,y)] + ajH(fj(x,y)) = aigi(x,y) + ajgj(x,y)

则称H是一个线性算子。（两个等式分别称为 加性，同质性）否则为非线性算子。（比如池化pooling）

线性处理以大量的可用于图像处理的理论实践结果为基础。

非线性应用受到更多限制，但是有些性能会远优于线性操作的非线性图像处理。

## 2.6.3算术操作
噪声处理:（机械噪声）

增强差别:比如碘介质血管X射线造影

图像相乘/除：阴影矫正

### 2.6.4 集合的逻辑操作

#### 基本集合操作
并集，交集，互斥集，差集，

#### 逻辑操作
处理二值图像时，OR/AND和NOT XORT就是普通的并交和求补 异或操作。逻辑一词来自于逻辑理论，在逻辑理论中，1表示真，0表示假

#### 模糊集合
允许用概率来代替0/1的事件

### 2.6.5 空间操作

#### 单像素
以灰度为基础，对单个像素做映射变换
### 邻域
![](DIPL.md.Pic\2.6-21.png)

其中Sxy是大小为mxn，中心在(x,y)的矩形领域中像素的平均值 //可以用来打马赛克么。。。
#### 几何空间变换的图像配准

几何变换改进图像中像素间的空间关系，常称为 橡皮膜变换。

由两个基本操作组成 

i）坐标的空间变换
(x,y) = T{(v,w)}    例如 (x,y) = T{(v,w)} = (v/2, w/2) 在两个方向上把原图缩小一半

仿射变换：
![](DIPL.md.Pic\2.6-23.png)

根据矩阵T中的值，对一组坐标点做尺度/旋转/平移或偏移
 
![](DIPL.md.Pic\Table2.2.jpg)

实际上，我们可以按照两种基本方法来使用仿射变换公式。
向前映射: 扫描输入图像的像素，并在每个位置(v,w)直接计算输出图像中相应像素的空间位置(x,y)构成

反向映射:扫描输出像素的位置，并在每一个位置(x,y)使用(v,w) = T^-1 (x,y) 这样更高效

图像配准：解决图像畸变问题，比如卫星图像照的地球是个球面

有多种模型解决此类问题，最简单的模型比如双线性近似
    
    x = c1 v + c2 w + c3vw + c4
    
    y = c5 v + c6 w + c7vw + c8

四个约束点即可计算c1~c8间的关系。组成一个个四边形。 

一般采用多个四边形覆盖一幅图像，以覆盖不同区域的不同畸变程度。

比如二维码扫描的初步处理


### 2.6.6 向量与矩阵

像素向量z 和一个任意点a 在n维空间的欧式距离D可以用一个向量积来定义：

![](DIPL.md.Pic\2.6-27.jpg)

向量范数，表示为 ||z - a||

像素向量的另一个重要优点是由下式表示的线性变换

    w = A(z - a)        //A是mxn的矩阵 z和a是 nx1大小的列向量。 

### 2.6.7 图像变换

二维线性变换 

![](DIPL.md.Pic\2.6-30.jpg)

其中f(x,y) 是输入图像 r(x,y,u,v)正变换核，

### 2.6.8 概率方法
 
xxx只是一些介绍性文字和举例

# 3 灰度变换与空间滤波

## 3.1 背景知识
### 3.1.1 灰度变换和空间滤波基础

空间域技术直接在图像像素上操作。对于频率域来说，其操作在图像的傅里叶变换上执行，而不针对图像本身。

空间滤波：对图像序列进行逐像素的扫描
领域与预定义的操作 一起被称为 空间滤波器 （或 空间掩膜，核，窗口或模板）
在领域中执行的操作类型决定了滤波处理的特性。

### 3.1.2 关于本章中的例子
多是图像增强应用。对图像加工，使其结果对于**特定**的应用比原始图像更适合的一种处理。（意味着增强技术是面对问题的。）

### 3.2 一些基本的灰度变换函数
#### 3.2.1 图像反转
图像灰度变化 s = L -1 -r    (比如X光分离)

其中s是目标灰度，[0,L-1]是灰度级数范围 r是源的灰度

#### 3.2.2 对数变换
通用形式为 s = c log(1 + r)

其中c是一个常数。该变换将输入中范围较窄的地灰度值映射为输出中较宽范围的灰度值，相反地，对搞得输入灰度值也是如此。我们使用这种类型的变换来扩展图像中暗像素的值。

#### 3.2.3 伽马变换 （幂律变换）
通用形式 s = c r^y 

其中c 和y均为正常数

#### 3.2.4 分段线性变换函数
优点是分段线性函数的形式可以是任意复杂的。

缺点是技术说明明确要求用户输入

##### 对比度拉伸

##### 比特平面分层
把一幅图像分解为比特平面，对于分析图像中每个比特的相对重要性是很有用,这一处理可帮助我们确定用于该图像的比特数的充分性。此外这种类型的分解对图像压缩也很有作用，在图像压缩中，重建一幅图像时，所用的平面要比全部平面少。

### 3.3 直方图处理

最简单有效的工具之一。
#### 3.3.1 直方图均衡
目标灰度 ps(s) = 1 / (L - 1)

![](DIPL.md.Pic\3.3-8.png) MN是图像中像素个数 nk是图像中灰度为rk的像素个数

推导过程就先布列出来了，有兴趣翻书看。比较简单

输出图像通过公式3.3-8 将输入图像中灰度级为rk的各像素映射到输出图像中灰度级为sk的对应像素得到。在这个公式中，变换T(rk)称为直方图均衡或 直方图线性变换。
 
一幅图的直方图与原图灰度值映射公式，直接由密度公式求得。

直方图处理会离散渐进的边缘，出现伪轮廓

#### 3.3.2 直方图匹配 （规定化）
处理后的图像有预先规定的直方图形状。

即根据给定源图像的灰度密度函数PDF和生成图像的灰度密度函数PDF。计算变换过程

比如 原图像 pr(r) = 2r/(L -1)^2 生成图像pz(z)=3z^2/(L-1)^3

首先[0,L-1]寻找直方图均衡变换:

![](DIPL.md.Pic\Ex3.7L1.png)

输入灰度值的平方 除以 (L-1)^2 将产生一幅灰度为s并具有均匀PDF的图像，因为这是早些时候讨论的直方图均衡变换。但我们感兴趣的是具有规定直方图的图像，因此，在[0,L-1]区间寻找下一个直方图均衡变换:

![](DIPL.md.Pic\Ex3.7L2.png)

最后求G(z) = s,但 G(z) = z^3 / (L -1)^2连立等式得

z= [(L-1)^2 * s]^1/3 又s = r^2 /(L - 1)

则 z = [(L-1)r^2]^1/3 是目标转换函数

总结：其实这里是一个正过程加一个逆过程的叠加，如果把源图像和目标图像都映射到同一个均衡直方图中，令这个均衡直方图是 z 则 T(r) = T'(z) = 常数 MN / (L - 1)

则z = T'^-1(T(r))

实例：略

直方图均衡和直方图匹配的比较:直方图匹配可以差异化放大图片中特定灰度范围的对比度，以改善图像质量

### 3.4 空间滤波基础

#### 3.4.1 空间滤波机理
在一个领域执行，对该领域包围的图像像素执行的预定义操作组成

#### 3.4.2空间相关与卷积

在执行线性空间滤波时候，对该领域包围的图像像素执行预定义操作。滤波产生一个新像素，新像素的坐标等于领域中心的坐标，像素的值是滤波操作的结果。

#### 3.4.2空间相关与卷积

两个相近的盖帘一个是相关，一个是卷积。

相关是滤波器模板移过图像并计算每个位置成绩之和的处理。卷积的机理相似，但滤波器首先要旋转180°。

旋转，指的是多维方向旋转。

![](DIPL.md.Pic\3.30.png)

卷积的数学表示:
![](DIPL.md.Pic\3.4-2.png)

-s -t表示翻转180，如果是相关即+s +t五角星为空心五角星

图像处理文献中，可能会遇到卷积滤波器，卷积模板，卷积核这些术语。按惯例，这些术语用来表示一种空间滤波器，并且滤波器未必用于真正的卷积。类似地，模板与图像的卷积通常用于我们刚刚讨论的滑动乘积求和处理，而不必区分相关与卷积间的差别。

#### 3.4.3 线性滤波的向量表示

R = wTz (wT滤波器的倒置 z 由滤波器覆盖的相应图像灰度值)

#### 3.4.5 空间滤波器模板的产生
高斯模糊是一种图像模糊滤波器，它用正太分布计算图像中每个像素的变。N维空间正太分布方程为
![](DIPL.md.Pic\3.4.5-1.png)

这样进行模糊处理比其他的均衡模糊滤波器更高的保留了边缘效果。

理论上讲，图像中每个像素的分布都不为0，也就是说每个像素的计算都要包含整幅图像。在实际应用中，计算高斯函数的离散近似时，大概3σ距离之外的像素可以认为不起作用，这些像素的计算就可以忽略。通常，图像只需要处理(6σ +1) x (6σ +1)的矩阵就可以保证相关像素影响。

除了圆形对称之外，高斯模糊也可以在二维图像上对两个独立的一维空间分别进行计算，这叫作线性可分。这也就是说，使用二维矩阵变换得到的效果也可以通过在水平方向进行一维高斯矩阵变换加上竖直方向的一维高斯矩阵变换得到。从计算的角度来看，这是一项有用的特性，因为这样只需要

对一幅图像进行多次连续高斯模糊的效果与一次更大的高斯模糊可以产生同样的效果，大的高斯模糊的半径是所用多个高斯模糊半径平方和的平方根。例如，使用半径分别为 6 和 8 的两次高斯模糊变换得到的效果等同于一次半径为 10 的高斯模糊效果， 。根据这个关系，使用多个连续较小的高斯模糊处理不会比单个高斯较大处理时间要少。
![](DIPL.md.Pic\3.4.5-2.png)

### 3.5 平滑空间滤波器
#### 3.5.1 平滑空间滤波
降低图像灰度的的输出是包含在滤波器模板领域内的像素简单平均值。
也称为均值滤波器。常用目的就是降低噪声。

加权的均值滤波器
![](DIPL.md.Pic\3.5-1.png)

平滑滤波器模板，其中数字是权值
![](DIPL.md.Pic\3.32.png)

#### 3.5.2 统计排序滤波器（非线性）
这种滤波器的响应以滤波器包围的图像区域中，所包含的像素排序为基础，使用统计排序结果决定替代中心像素的值。比如中值滤波器，将像素领域内灰度的中值代替该像素的值。它提供了一种优秀的去噪能力，而且比相同尺寸的线性平滑滤波器的模糊层度明显要低。它对付椒盐噪声非常有效。

### 3.6 锐化空间滤波器

主要目的是突出灰度的过度部分，图像锐化的用途
#### 3.6.1 基础
对于一维函数，其一阶微分的基本定义是差值

![](DIPL.md.Pic\3.6-1.png)

对于二阶微分，定义为如下差分

![](DIPL.md.Pic\3.6-2.png)

下图显示了一段扫描线，小方块中是扫描线中的灰度值


![](DIPL.md.Pic\3.36.png)

图中的零交叉对于边缘定位是十分重要的。

#### 3.6.2 使用二阶微分进行图像锐化 --- 拉普拉斯算子

各向同性滤波器是旋转不变的，即将原图像旋转后进行滤波处理给出的结果与原图像滤波再旋转的结果相同。

一个二维图像函数f(x,y)的拉普拉斯算子定义为：

![](DIPL.md.Pic\3.6-3.png)

![](DIPL.md.Pic\3.6-6.png)

实际使用的基本表达式即
g(x,y) = f(x,y) + c[▼²f(x,y)]

Ps：华为手机拍月亮可能就是用的这种滤波器

#### 3.6.3 非锐化掩蔽和高提升滤波

非锐化掩蔽的步骤：
1.掩蔽原图像
2.从原图像中减去模糊图像
3.将模板加载到源图像上

令f'(x,y) 表示模糊图像，模板：
g_mask(x,y) = f(x,y) - f'(x,y)
然后再原图像上加上改模板的一个权重部分:
g(x,y) = f(x,y) + k * g_mask(x,y)
当k > 1时，我们将该处理称为高提升滤波
k< 1 时，我们将该处理称为 非锐化掩膜

![](DIPL.md.Pic\3.39.png)

#### 3.6.4 使用一阶微分对（非线性）图像锐化------梯度
 
![](DIPL.md.Pic\3.6-18.png)

卷积模板

![](DIPL.md.Pic\3.14.png)

图中 d和e 的模板称为 soble算子，中心系数使用权重2的思想是通过突出中心点的作用而达到平滑的目的

常用于工业成像诊断产品缺陷使用，比如隐形眼镜边缘完损性检测。

### 3.7 混合空间增强法
多种方法叠加使用

###  3.8 使用模糊技术进行灰度变换和空间滤波

#### 3.8.1 引言

如2.6.4

#### 3.8.2 模糊集合论原理
模糊集合为处理不严密信息提供了一种形式

定义:令Z 为元素对象，z表示Z的一类元素 Z = {z}。 该集合Z称为论域

Z中的模糊集合 A由 隶属度函数 ua(z) 表征， 它是与Z的元素相关，取值在[0,1]内的一个实数。ua(z)在z处的值表示A中z的隶属度等级。最接近ua(z)的值与在A中的z的较高的隶属度等级趋于一致，而当ua(z)接近于0时，则相反。

因此对于ua(z) = 1的成员z，是集合的完全成员

对于ua(z) = 0的成员z，都不是集合的成员。

当ua(z)的取值 介于 0~1之间，z则是集合Z的部分成员。

模糊集合的表示：定义模糊集合 A = {z, ua(z) | z 属于 Z}

集合关系的扩展

    空集:当且仅当Z中的隶属度函数为0，模糊集合为空集

    相等:当且仅当对于所有的z属于Z，由 ua(z) = ub(z)，两个模糊集合A。B相等

    补集:NOT(A) = B表示模糊集合A 的补集，定义为其隶属度函数 ub(z) = 1 - ua(z)

    子集:当且仅当对于所有的 z属于Z，由 ua(z) <= ub(z) 模糊集合A是 B的子集

    并集:对于所有z属于Z，两个模糊集合AB并集 Uu(z) = max[ua(z), ub(z)]

    交集:对于所有z属于Z，两个模糊集合AB并集 Uu(z) = min[ua(z), ub(z)]


以下给出了常用隶属度函数的形式和图形

![](DIPL.md.Pic\常用隶属度函数.png) 

![](DIPL.md.Pic\常用隶属度函数图形.png) 


#### 3.8.3 模糊集合的应用

#### 3.8.4 使用模糊集合进行灰度变换

比如在做对比度增强时，使用模糊合集定义三种模糊项

IF 像素 暗 THEN 输出 暗

IF 像素 灰 THEN 输出 灰

IF 像素 亮 THEN 输出 亮

则具有如下公式表述
![](DIPL.md.Pic\3.8-22.png) 

基于如上规则的对比度增强相关度图形
![](DIPL.md.Pic\3.53.png) 


#### 3.8.5 使用模糊集合进行空间滤波

比如4领域下：

IF d2 =0 AND d6=0 THEN z5 = 0

IF d2 =0 AND d6=0 THEN z5 = 0

IF d2 =0 AND d6=0 THEN z5 = 0

IF d2 =0 AND d6=0 THEN z5 = 0

ELSE z5 = 1

这样，如果a5是噪点的化就会被消除，如果是边界的话，就会被保留 （0白色模糊集 1 黑色模糊集）

其中隶属函数图如下:

![](DIPL.md.Pic\3.57.png) 

# 第四章 频率与域滤波

## 引言

前一章主要解决锐化和模糊问题，但如果不了解在图像滤波中如何应用傅里叶变换和频率域的基本知识，想彻底了解这一个领域也是不太可能的。关键在于要关注基本原理和他们数字图像处理的关系。本章为傅里叶变换的基本原理打下一个基础，并介绍基本图像滤波中如何使用傅里叶变换。

并且接触几个重要的取样问题，例如混淆，这些处理要求对频率域滤波的理解。

## 4.1 背景



4.2














